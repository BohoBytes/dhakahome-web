{{define "content"}}
<!-- Header -->
{{template "partials/page-header.html" .}}

<!-- Contact Content -->
<section class="py-10 space-y-5">
  <div class="space-y-1">
    <p
      class="text-[#F44335] text-[28px] md:text-[32px] font-medium leading-[36px]"
      style="font-family: 'Poppins', sans-serif"
    >
      Have Questions?
    </p>
    <p
      class="text-[#656565] text-[18px] leading-[26px]"
      style="font-family: 'Poppins', sans-serif"
    >
      We’re Just a Message Away
    </p>
  </div>

  <div class="grid gap-6 md:grid-cols-2 items-stretch">
    <div
      class="bg-[#f2f2f2] rounded-[10px] shadow-[0_1px_8.5px_4px_rgba(0,0,0,0.25)] overflow-hidden h-full"
    >
      <img
        src="/assets/images/illustrations/contact-banner.png"
        alt="City illustration"
        class="w-full h-full max-h-[500px] object-cover"
      />
    </div>

    <div
      class="bg-[#f6f6f6] rounded-[10px] shadow-[0_1px_8.5px_4px_rgba(0,0,0,0.25)] p-6 md:p-8 space-y-5 h-full flex flex-col"
    >
      <h2
        class="text-[#656565] text-[22px] leading-[30px] font-normal"
        style="font-family: 'Poppins', sans-serif"
      >
        We’re Just a Message Away
      </h2>
      <form
        action="/lead"
        method="post"
        class="space-y-4 flex-1 flex flex-col"
        id="contact-page-form"
        data-contact-page-form
        data-contact-email="{{.ContactEmail}}"
      >
        <input type="hidden" name="contactEmail" value="{{.ContactEmail}}" />
        <input
          name="name"
          type="text"
          required
          placeholder="Name"
          class="w-full bg-white border border-[#7c7c7c] rounded-[5px] px-4 py-[10px] text-[18px] leading-[26.4px] text-[#414141] placeholder-[#afafaf] focus:outline-none focus:ring-2 focus:ring-[#f44335]"
          style="font-family: 'Poppins', sans-serif"
        />
        <p class="text-[#f44335] text-[13px] hidden" data-error-for="name"></p>
        <input
          name="email"
          type="email"
          required
          placeholder="Email"
          class="w-full bg-white border border-[#7c7c7c] rounded-[5px] px-4 py-[10px] text-[18px] leading-[26.4px] text-[#414141] placeholder-[#afafaf] focus:outline-none focus:ring-2 focus:ring-[#f44335]"
          style="font-family: 'Poppins', sans-serif"
        />
        <p class="text-[#f44335] text-[13px] hidden" data-error-for="email"></p>
        <input
          name="phone"
          type="tel"
          placeholder="Phone"
          class="w-full bg-white border border-[#7c7c7c] rounded-[5px] px-4 py-[10px] text-[18px] leading-[26.4px] text-[#414141] placeholder-[#afafaf] focus:outline-none focus:ring-2 focus:ring-[#f44335]"
          style="font-family: 'Poppins', sans-serif"
        />
        <p class="text-[#f44335] text-[13px] hidden" data-error-for="phone"></p>
        <textarea
          name="message"
          rows="4"
          placeholder="Ask Your Questions Here"
          class="w-full bg-white border border-[#7c7c7c] rounded-[5px] px-4 py-[10px] text-[18px] leading-[26.4px] text-[#414141] placeholder-[#afafaf] focus:outline-none focus:ring-2 focus:ring-[#f44335] resize-none flex-1"
          style="font-family: 'Poppins', sans-serif"
        ></textarea>
        <p
          class="text-[#f44335] text-[13px] hidden"
          data-error-for="message"
        ></p>
        <p class="text-[#f44335] text-[13px] hidden" data-error-for="form"></p>

        <button
          type="submit"
          class="w-full bg-[#f44335] hover:bg-[#d63a2e] text-white text-[20px] font-medium leading-[30px] rounded-[5px] py-[10px] transition-colors"
          style="font-family: 'Poppins', sans-serif"
        >
          Send
        </button>
      </form>
    </div>
  </div>
</section>

<div
  id="contact-success-overlay"
  class="fixed inset-0 left-0 right-0 top-0 bottom-0 w-screen max-w-none bg-black/70 z-50 hidden items-center justify-center px-4"
  style="max-width: 100vw"
>
  <div
    class="relative w-full max-w-[430px] rounded-[10px] bg-[#fafafa] px-8 py-10 text-center shadow-[0_10px_30px_rgba(0,0,0,0.25)]"
  >
    <button
      type="button"
      class="absolute right-4 top-4 text-[#767676] hover:text-[#111] text-3xl"
      data-overlay-close
      aria-label="Close"
    >
      &times;
    </button>
    <div
      class="mx-auto mb-6 flex h-16 w-16 items-center justify-center rounded-full bg-[#2fd073] text-white"
    >
      <svg
        class="h-9 w-9"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2.5"
        stroke-linecap="round"
        stroke-linejoin="round"
        aria-hidden="true"
      >
        <path d="M20 6 9 17l-5-5" />
      </svg>
    </div>
    <h3
      class="text-[32px] font-medium leading-[40px] text-[#353535]"
      style="font-family: 'Poppins', sans-serif"
    >
      Message Sent
    </h3>
    <p
      class="mt-3 text-[18px] leading-[28px] text-[#767676]"
      style="font-family: 'Poppins', sans-serif"
    >
      Our team will contact you shortly with more details about the property.
    </p>
  </div>
</div>

<script>
  (function () {
    const form = document.querySelector("[data-contact-page-form]");
    if (!form) return;

    const contactEmail = form.dataset.contactEmail || "";
    const overlay = document.getElementById("contact-success-overlay");
    const nameInput = form.querySelector('input[name="name"]');
    const emailInput = form.querySelector('input[name="email"]');
    const phoneInput = form.querySelector('input[name="phone"]');
    const messageField = form.querySelector('textarea[name="message"]');

    const clearErrors = () => {
      form.querySelectorAll("[data-error-for]").forEach((el) => {
        el.textContent = "";
        el.classList.add("hidden");
      });
      form.querySelectorAll("input, textarea").forEach((el) => {
        el.classList.remove("border-[#f44335]");
      });
    };

    const showError = (field, message) => {
      const errorEl = form.querySelector(`[data-error-for="${field}"]`);
      if (errorEl) {
        errorEl.textContent = message;
        errorEl.classList.remove("hidden");
      }
      const inputEl =
        form.querySelector(`[name="${field}"]`) ||
        (field === "message" ? messageField : null);
      if (inputEl) {
        inputEl.classList.add("border-[#f44335]");
      }
    };

    const normalizePhone = (phone) => {
      let clean = (phone || "").trim();
      if (!clean) return null;
      clean = clean.replace(/[^0-9+]/g, "");
      if (clean.startsWith("+")) clean = clean.slice(1);
      if (clean.startsWith("88")) clean = clean.slice(2);
      if (!clean.startsWith("01")) return null;
      if (clean.length !== 11) return null;
      const operator = clean.charAt(2);
      if (operator < "3" || operator > "9") return null;
      return `+880${clean.slice(1)}`;
    };

    const showOverlay = () => {
      if (!overlay) return;
      overlay.classList.remove("hidden");
      overlay.classList.add("flex");
      document.body.classList.add("overflow-hidden");
    };

    const hideOverlay = () => {
      if (!overlay) return;
      overlay.classList.add("hidden");
      overlay.classList.remove("flex");
      document.body.classList.remove("overflow-hidden");
    };

    overlay?.addEventListener("click", (event) => {
      if (event.target === overlay) hideOverlay();
    });
    overlay
      ?.querySelectorAll("[data-overlay-close]")
      .forEach((btn) => btn.addEventListener("click", hideOverlay));

    form.addEventListener("submit", async (event) => {
      event.preventDefault();
      clearErrors();

      const name = (nameInput?.value || "").trim();
      const email = (emailInput?.value || "").trim();
      const message = (messageField?.value || "").trim();
      const phoneRaw = (phoneInput?.value || "").trim();
      const phone = phoneRaw ? normalizePhone(phoneRaw) : "";
      const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      let valid = true;

      if (name.length < 2) {
        showError("name", "Please enter your name.");
        valid = false;
      }
      if (!emailPattern.test(email)) {
        showError("email", "Please enter a valid email.");
        valid = false;
      }
      if (phoneRaw && !phone) {
        showError("phone", "Use a valid Bangladesh phone number.");
        valid = false;
      }
      if (!message) {
        showError("message", "Please include a message.");
        valid = false;
      }
      if (!valid) return;

      const payload = {
        name,
        email,
        phone: phone || phoneRaw,
        message,
        propertyId: "",
        contactEmail,
      };

      try {
        const res = await fetch("/lead", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Accept: "application/json",
            "X-Requested-With": "XMLHttpRequest",
          },
          body: JSON.stringify(payload),
        });

        if (!res.ok) {
          const data = await res.json().catch(() => null);
          if (data && data.errors) {
            Object.entries(data.errors).forEach(([field, msg]) =>
              showError(field, msg)
            );
          } else {
            showError("form", "Could not send your request. Please try again.");
          }
          return;
        }
      } catch (err) {
        showError("form", "Network issue, please retry.");
        return;
      }

      showOverlay();
      form.reset();
    });
  })();
</script>
{{end}} {{define "pages/contact-us.html"}}{{template "layouts/base.html"
.}}{{end}}
